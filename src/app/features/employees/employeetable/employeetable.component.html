<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>
<div class="page-layout">
  <div class="header section">
    <h2>Employees</h2>

    <!-- Search box -->

    <div class="right-headers">
      <mat-form-field
        appearance="outline"
        class="search-field"
      >
        <span
          matPrefix
          class="fa fa-search search-icon"
        ></span>

        <input
          matInput
          (keyup)="applyFilter($event)"
          [value]="filterValues?.global"
          placeholder="Search..."
          class="search-input"
        />
      </mat-form-field>

      <!-- User-Name  Section -->

      <div class="user-logout">
        <div class="username">
          <i class="fa fa-user"></i>
          {{ username }}
        </div>

        <div class="right-headers-btn">
          <!--Add Button-->

          <button
            id="add"
            type="button"
            data-tooltip="Add"
            (click)="gotoAdd()"
            matTooltip="Add"
            matTooltipShowDelay="300"
            matTooltipHideDelay="100"
          >
            <i class="fa-solid fa-plus icon"></i>
          </button>
          <!--ResetAll Button-->
          <button
            id="resetAll"
            type="button"
            (click)="resetAll()"
            matTooltip="Reset"
            matTooltipShowDelay="300"
            matTooltipHideDelay="100"
          >
            <i class="fa-solid fa-rotate-left icon"></i>
          </button>
          <!--SaveFilterstate Button-->
          <button
            id="save"
            type="button"
            (click)="saveFilterState()"
            matTooltip="Save Filter Preference"
            matTooltipShowDelay="300"
            matTooltipHideDelay="100"
          >
            <i class="fa-solid fa-floppy-disk icon"></i>
          </button>

          <!--Logout Button-->

          <button
            class="logout-btn"
            type="button"
            (click)="logout()"
            matTooltip="Logout"
            matTooltipShowDelay="300"
            matTooltipHideDelay="100"
          >
            <i
              class="fa-solid fa-right-from-bracket icon"
            ></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- TABLE SCROLL CONTAINER -->
  <div class="content-area">
    <mat-card class="table-card mat-elevation-z4">
      <div class="table-scroll-container">
        <!-- Material table -->
        <table
          mat-table
          [dataSource]="dataSource"
          matSort
          class="mat-elevation-z8"
        >
          <!-- Code Column -->
          <ng-container matColumnDef="empCode">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="empCode"
              disableClear
            >
              <div class="header-cell-content">
                <span class="no-click">Code</span>
                <i
                  class="fa-solid fa-filter filter-btn"
                  [class.filter-active]="
                    filteredColumns.empCode
                  "
                  [class.sort-active]="
                    sortedColumns.empCode
                  "
                  (click)="
                    openColumnFilter('empCode', $event);
                    $event.stopPropagation()
                  "
                ></i>
              </div>
            </th>

            <td mat-cell *matCellDef="let element">
              {{ element.empCode }}
            </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="empName">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="empName"
              disableClear
            >
              <div class="header-cell-content">
                <span class="no-click">Name</span>
                <i
                  class="fa-solid fa-filter filter-btn"
                  [class.filter-active]="
                    filteredColumns.empName
                  "
                  [class.sort-active]="
                    sortedColumns.empName
                  "
                  (click)="
                    openColumnFilter('empName', $event);
                    $event.stopPropagation()
                  "
                ></i>
              </div>
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.empName }}
            </td>
          </ng-container>

          <!-- Phone Column -->
          <ng-container matColumnDef="empPhoneno">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="empPhoneno"
              disableClear
            >
              <div class="header-cell-content">
                <span class="no-click">Phone</span>
                <i
                  class="fa-solid fa-filter filter-btn"
                  [class.filter-active]="
                    filteredColumns.empPhoneno
                  "
                  [class.sort-active]="
                    sortedColumns.empPhoneno
                  "
                  (click)="
                    openColumnFilter('empPhoneno', $event);
                    $event.stopPropagation()
                  "
                ></i>
              </div>
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.empPhoneno }}
            </td>
          </ng-container>

          <!-- Email Column -->
          <ng-container matColumnDef="empEmailId">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="empEmailId"
              disableClear
            >
              <div class="header-cell-content">
                <span class="no-click">Email</span>
                <i
                  class="fa-solid fa-filter filter-btn"
                  [class.filter-active]="
                    filteredColumns.empEmailId
                  "
                  [class.sort-active]="
                    sortedColumns.empEmailId
                  "
                  (click)="
                    openColumnFilter('empEmailId', $event);
                    $event.stopPropagation()
                  "
                ></i>
              </div>
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.empEmailId }}
            </td>
          </ng-container>

          <!-- Action Column -->
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>
              Action
            </th>
            <td mat-cell *matCellDef="let element">
              <div class="action-container">
                <button
                  class="edit-btn"
                  mat-icon-button
                  color="primary"
                  (click)="editEmployee(element.empCode)"
                  matTooltip="Edit"
                  matTooltipShowDelay="300"
                  matTooltipHideDelay="100"
                >
                  <i class="fa fa-edit"></i>
                </button>

                <button
                  class="delete-btn"
                  mat-icon-button
                  color="warn"
                  (click)="deleteEmployee(element.empCode)"
                  matTooltip="Delete"
                  matTooltipShowDelay="300"
                  matTooltipHideDelay="100"
                >
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </td>
          </ng-container>

          <!-- Header and Row -->
          <tr
            mat-header-row
            *matHeaderRowDef="
              displayedColumns;
              sticky: true
            "
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
          ></tr>
          <!-- NO DATA FOUND ROW -->
          <tr class="no-data-box" *matNoDataRow>
            <td
              [attr.colspan]="displayedColumns.length"
              class="no-data-cell"
            >
              <i class="fa-solid fa-circle-info"></i>
              No records found
            </td>
          </tr>
        </table>
      </div>
    </mat-card>
    <!-- COMMON COLUMN FILTER BOX -->
    <div
      class="common-filter-box"
      [style.display]="activeColumnFilter ? 'flex' : 'none'"
      [style.top.px]="filterBoxTop"
      [style.left.px]="filterBoxLeft"
      #commonFilterBox
    >
      <div class="filter-box-topElements">
        <mat-form-field
          appearance="outline"
          class="search-field"
        >
          <mat-label>
            Filter by
            {{ columnLabelMap[activeColumnFilter!] }}
          </mat-label>
          <span
            matPrefix
            class="fa fa-search search-icon"
          ></span>

          <input
            matInput
            #filterInput
            [attr.data-column]="activeColumnFilter"
            placeholder="Search..."
            (keyup)="
              applyColumnFilter(activeColumnFilter!, $event)
            "
            (keydown.escape)="activeColumnFilter = null"
            [value]="filterValues?.[activeColumnFilter!]"
          />
        </mat-form-field>
        <button class="filter-resetBtn">
          <i
            matSuffix
            class="fa-solid fa-rotate-left icon filter-reset-btn"
            (click)="resetColumnFilter(activeColumnFilter!)"
          ></i>
        </button>
      </div>

      <div class="sort-container">
        <div
          class="sort-btn"
          (click)="sortColumn('asc')"
          [class.sort-btn-active]="
            sortedColumns[activeColumnFilter!] === 'asc'
          "
        >
          Sort &UpTeeArrow;
        </div>
        <div
          class="sort-btn"
          [class.sort-btn-active]="
            sortedColumns[activeColumnFilter!] === 'desc'
          "
          (click)="sortColumn('desc')"
        >
          Sort &DownTeeArrow;
        </div>
      </div>
    </div>
  </div>
  <!-- FOOTER (PAGINATOR) -->
  <div class="app-footer">
    <!-- Paginator -->
    <mat-paginator
      [pageSize]="10"
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
    >
    </mat-paginator>
  </div>
</div>
